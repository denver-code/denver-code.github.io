<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Reverse engineering .NET WPF Pacman using dnSpy
        
    </title><meta content="Reverse engineering .NET WPF Pacman using dnSpy" property=og:title><link href=https://ihorsavenko.com/fonts.css rel=stylesheet><script>(function () {
                  var el = document.createElement('script');
                  el.setAttribute('src', '/js/imamu.js');
                  el.setAttribute('data-website-id', 'fa6a920f-db21-406a-afe7-5caf4db6c791');
                  el.setAttribute('data-host-url', 'https:&#x2F;&#x2F;umami-azure-one.vercel.app');
                  document.body.appendChild(el);
                })();</script><script async data-host-url=https://umami-azure-one.vercel.app data-website-id=fa6a920f-db21-406a-afe7-5caf4db6c791 src=/js/imamu.js></script><link href=https://ihorsavenko.com/atom.xml rel=alternate title=denver-code type=application/atom+xml><link href=https://ihorsavenko.com/theme/light.css rel=stylesheet><link href=https://ihorsavenko.com/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ihorsavenko.com/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ihorsavenko.com>denver-code</a><div class=socials><a class=social href=https://t.me/operatorSilence rel=me> <img alt=telegram src=/social_icons/telegram.svg> </a><a class=social href=https://github.com/denver-code/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=/projects style=margin-left:.7em>/projects</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/about style=margin-left:.7em>/about</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert()> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ihorsavenko.com/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Reverse engineering .NET WPF Pacman using dnSpy<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2024-09-15</time></div></div><section class=body><p><strong>Reverse-engineering</strong> - is the act of dismantling an object to see how it works. It is done primarily to analyze and gain knowledge about the way something works but often is used to duplicate or enhance the object.<p>Watch on youtube - <a href="https://www.youtube.com/watch?v=5Nqgh85c3JI">https://www.youtube.com/watch?v=5Nqgh85c3JI</a><h2 id=level-easy>Level - <strong>easy</strong></h2><p>In today's episode we are going to reverse engineer and modify an simple game written in C# .NET WPF.<p><img alt=pacman src=https://ihorsavenko.com/posts/moddingpacman/pacman.png><p>You are pacman (yellow guy), you can move in 4 directions (top, down, left, right), earn coins by eating them, winning by collecting 84 coins in total, however you can get eaten by one of the <strong>ghosts</strong>.<p>It's a straightforward gameplay, but we're IT guys, which means we can bypass certain mechanics.<br> And in this case we're going to:<ol><li>Disable dying<li>Increse the amount of points out of the coins<li>Enable eating of ghosts<li>Enable flying through walls<li>Add text that we have modded it (leaving credit - important step haha)<li>Make main player faster<li>Make Ghosts edible, so we can earn some points of them too!</ol><p>We will achieve this by using cool piece of software called <a href=https://github.com/dnSpy/dnSpy><code>dnSpy</code></a> (discontinued but well made fork of ILSpy).<h1 id=stage-1-getting-source-code>Stage 1 - Getting source code</h1><p><strong>Compiling</strong> is the process of converting human-readable code into machine-readable code. This is usually done by a software program called a compiler, which takes the source code and translates it into executable instructions for the computer to carry out.<p>By doing <strong>reverse engineering</strong> we likely won't be able to get the initial code base, as after compiling some bits was replaced by something else, something was mooved, etc.<p>But we still will be able to get most of the data that we need to amend changes.<p>So let's dive into it, open up the <code>dnSpy</code> (x64/x32 depending on the application) and simply drag'n drop the <code>.exe</code> file of the game to the <code>dnSpy</code> and you should see something like this:<br> <img alt="alt dnspy1" src=https://ihorsavenko.com/posts/moddingpacman/dnspy1.png><p>Here you will need to find the Main class of the application, and from here you will be able to navigate through and find required place to do the changes.<br> <img alt="alt text" src=https://ihorsavenko.com/posts/moddingpacman/structure.png><br> Here you can see all the game logic and variables, as it is very small.<p>You can click at each thing in this list and you should be able to see the code:<br> <img alt="alt text" src=https://ihorsavenko.com/posts/moddingpacman/collisions.png><br> For example the collisions part.<pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#f73>if </span><span>((</span><span style=color:#f73>string</span><span>)rectangle</span><span style=color:#f29668>.</span><span>Tag </span><span style=color:#f29668>== </span><span style=color:#c2d94c>"wall"</span><span>)
</span><span>{
</span><span>    </span><span style=color:#f73>if </span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goLeft </span><span style=color:#f29668>&& </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacmanHitBox</span><span style=color:#f29668>.</span><span style=color:#ffb454>IntersectsWith</span><span>(rect))
</span><span>    {
</span><span>        Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>SetLeft</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman</span><span style=color:#bfbab0cc>, </span><span>Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>GetLeft</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman) </span><span style=color:#f29668>+ </span><span style=color:#f29718>10</span><span style=color:#bfbab0cc>.</span><span style=color:#f29718>0</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>noLeft </span><span style=color:#f29668>= </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goLeft </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>    </span><span style=color:#f73>if </span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goRight </span><span style=color:#f29668>&& </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacmanHitBox</span><span style=color:#f29668>.</span><span style=color:#ffb454>IntersectsWith</span><span>(rect))
</span><span>    {
</span><span>        Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>SetLeft</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman</span><span style=color:#bfbab0cc>, </span><span>Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>GetLeft</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman) </span><span style=color:#f29668>- </span><span style=color:#f29718>10</span><span style=color:#bfbab0cc>.</span><span style=color:#f29718>0</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>noRight </span><span style=color:#f29668>= </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goRight </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>    </span><span style=color:#f73>if </span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goDown </span><span style=color:#f29668>&& </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacmanHitBox</span><span style=color:#f29668>.</span><span style=color:#ffb454>IntersectsWith</span><span>(rect))
</span><span>    {
</span><span>        Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>SetTop</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman</span><span style=color:#bfbab0cc>, </span><span>Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>GetTop</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman) </span><span style=color:#f29668>- </span><span style=color:#f29718>10</span><span style=color:#bfbab0cc>.</span><span style=color:#f29718>0</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>noDown </span><span style=color:#f29668>= </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goDown </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>    </span><span style=color:#f73>if </span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goUp </span><span style=color:#f29668>&& </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacmanHitBox</span><span style=color:#f29668>.</span><span style=color:#ffb454>IntersectsWith</span><span>(rect))
</span><span>    {
</span><span>        Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>SetTop</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman</span><span style=color:#bfbab0cc>, </span><span>Canvas</span><span style=color:#f29668>.</span><span style=color:#ffb454>GetTop</span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacman) </span><span style=color:#f29668>+ </span><span style=color:#f29718>10</span><span style=color:#bfbab0cc>.</span><span style=color:#f29718>0</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>noUp </span><span style=color:#f29668>= </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>goUp </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>}
</span></code></pre><h1 id=stage-2-amending-modifications>Stage 2 - Amending modifications</h1><p>Now we're going to disable collisions with the walls, let's simply delete the code block that you've seen before by Right-clicking at the code and then selecting <code>"Edit Method"</code>:<br> <img alt="alt text" src=https://ihorsavenko.com/posts/moddingpacman/editcols.png><br> Now select code that you'd like to remove and press <code>"backspace"</code> button on your keyboard to delete it, click <code>"Compile"</code> if that's all changes you'd like to do to save changes.<h2 id=changing-score-system>Changing score system</h2><p>Going further I've found the score incrementation logic:<pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#f73>if </span><span>((</span><span style=color:#f73>string</span><span>)rectangle</span><span style=color:#f29668>.</span><span>Tag </span><span style=color:#f29668>== </span><span style=color:#c2d94c>"coin" </span><span style=color:#f29668>&& </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacmanHitBox</span><span style=color:#f29668>.</span><span style=color:#ffb454>IntersectsWith</span><span>(rect) </span><span style=color:#f29668>&& </span><span>rectangle</span><span style=color:#f29668>.</span><span>Visibility </span><span style=color:#f29668>== </span><span>Visibility</span><span style=color:#f29668>.</span><span>Visible)
</span><span>{
</span><span>    rectangle</span><span style=color:#f29668>.</span><span>Visibility </span><span style=color:#f29668>= </span><span>Visibility</span><span style=color:#f29668>.</span><span>Hidden</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>score</span><span style=color:#f29668>++</span><span style=color:#bfbab0cc>;
</span><span>}
</span></code></pre><p>Let's fix it, and increase score by <code>50</code> each time when we <em>eat</em> the coin by changing logic to:<pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>score </span><span style=color:#f29668>+= </span><span style=color:#f29718>50</span><span style=color:#bfbab0cc>;
</span></code></pre><p>and that'll do.<h2 id=disable-dying-and-gettin-score-out-of-ghosts>Disable dying and gettin score out of ghosts</h2><pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#f73>if </span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacmanHitBox</span><span style=color:#f29668>.</span><span style=color:#ffb454>IntersectsWith</span><span>(rect))
</span><span>{
</span><span>    </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span style=color:#ffb454>GameOver</span><span>(</span><span style=color:#c2d94c>"Well better luck next time!"</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>}
</span></code></pre><p>Going to be:<pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#f73>if </span><span>(</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>pacmanHitBox</span><span style=color:#f29668>.</span><span style=color:#ffb454>IntersectsWith</span><span>(rect))
</span><span>{
</span><span>    rectangle</span><span style=color:#f29668>.</span><span>Visibility </span><span style=color:#f29668>= </span><span>Visibility</span><span style=color:#f29668>.</span><span>Hidden</span><span style=color:#bfbab0cc>;
</span><span>	</span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>score </span><span style=color:#f29668>+= </span><span style=color:#f29718>200</span><span style=color:#bfbab0cc>;
</span><span>}
</span></code></pre><p>And by doing that - our score will be incremented by 200 each time when we eat a ghost.<h2 id=leaving-a-credit>Leaving a credit</h2><pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>txtScore</span><span style=color:#f29668>.</span><span>Content </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"Score: " </span><span style=color:#f29668>+ </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>score</span><span style=color:#f29668>.</span><span style=color:#ffb454>ToString</span><span>()</span><span style=color:#bfbab0cc>;
</span></code></pre><p>-><pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>txtScore</span><span style=color:#f29668>.</span><span>Content </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"Score: " </span><span style=color:#f29668>+ </span><span style=color:#39bae6;font-style:italic>this</span><span style=color:#f29668>.</span><span>score</span><span style=color:#f29668>.</span><span style=color:#ffb454>ToString</span><span>() </span><span style=color:#f29668>+ </span><span style=color:#c2d94c>"Mod by @denver-code"</span><span style=color:#bfbab0cc>;
</span></code></pre><h2 id=changing-speeds>Changing speeds</h2><p>Once you've found variables of the app:<pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#f73>private int </span><span>speed </span><span style=color:#f29668>= </span><span style=color:#f29718>8</span><span style=color:#bfbab0cc>;
</span><span style=color:#f73>private int </span><span>ghostSpeed </span><span style=color:#f29668>= </span><span style=color:#f29718>10</span><span style=color:#bfbab0cc>;
</span><span>
</span></code></pre><p>You can change them too:<pre class=language-c# data-lang=c# style=color:#bfbab0;background-color:#0f1419><code class=language-c# data-lang=c#><span style=color:#f73>private int </span><span>speed </span><span style=color:#f29668>= </span><span style=color:#f29718>15</span><span style=color:#bfbab0cc>;
</span><span style=color:#f73>private int </span><span>ghostSpeed </span><span style=color:#f29668>= </span><span style=color:#f29718>5</span><span style=color:#bfbab0cc>;
</span></code></pre><h1 id=stage-3-saving>Stage 3 - saving</h1><p>After you are happy will all the changes, smash that save button:<br> <img alt=save src=https://ihorsavenko.com/posts/moddingpacman/save.png><br> And export your cracked pacman game!<p><img alt="alt text" src=https://ihorsavenko.com/posts/moddingpacman/cracked.png></section></article></main></div>